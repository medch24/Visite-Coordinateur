<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-lang-en="Teacher Evaluation System" data-lang-fr="Syst√®me d'√âvaluation des Enseignants">Teacher Evaluation System</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>

    <div class="container">
        <!-- Language Switcher -->
        <div class="language-switcher">
            <button id="lang-en">English</button>
            <button id="lang-fr">Fran√ßais</button>
        </div>

        <!-- Login Page -->
        <div id="login-page" class="page active">
            <div class="card">
                <h1 data-lang-en="Login" data-lang-fr="Connexion">Login</h1>
                <form id="login-form">
                    <input type="text" id="username" placeholder-en="Username" placeholder-fr="Nom d'utilisateur" required>
                    <div class="password-container">
                        <input type="password" id="password" placeholder-en="Password" placeholder-fr="Mot de passe" required>
                        <button type="button" id="toggle-password" class="password-toggle" aria-label="Show password">
                            <span id="password-icon">üëÅÔ∏è</span>
                        </button>
                    </div>
                    <div class="checkbox-container">
                        <input type="checkbox" id="remember-me">
                        <label for="remember-me" data-lang-en="Remember me" data-lang-fr="Rester connect√©">Remember me</label>
                    </div>
                    <button type="submit" data-lang-en="Login" data-lang-fr="Se connecter">Login</button>
                </form>
                <p id="login-error" class="error-message"></p>
                <div class="test-credentials">
                    <h4 data-lang-en="Test Accounts" data-lang-fr="Comptes de Test">Test Accounts</h4>
                    <p><strong data-lang-en="Coordinators" data-lang-fr="Coordinateurs">Coordinators:</strong><br>
                    Mohamed / Mohamed@86<br>
                    Zohra / Zohra@40<br>
                    Rasha / Rasha@26</p>
                    <p><strong data-lang-en="Teachers" data-lang-fr="Enseignants">Teachers:</strong><br>
                    Morched / Morched<br>
                    Kamel / Kamel<br>
                    <em data-lang-en="(Any teacher name as username/password)" data-lang-fr="(Nom d'enseignant comme identifiant/mot de passe)">(Any teacher name as username/password)</em></p>
                </div>
            </div>
        </div>

        <!-- Coordinator Dashboard -->
        <div id="coordinator-dashboard" class="page">
            <h1 data-lang-en="Coordinator Dashboard" data-lang-fr="Tableau de Bord Coordinateur">Coordinator Dashboard</h1>
            <h2 id="coordinator-welcome"></h2>
            
            <!-- Navigation Tabs -->
            <div class="coordinator-tabs">
                <button id="new-evaluation-tab" class="tab-btn active" data-lang-en="New Evaluation" data-lang-fr="Nouvelle √âvaluation">Nouvelle √âvaluation</button>
                <button id="view-evaluations-tab" class="tab-btn" data-lang-en="Previous Evaluations" data-lang-fr="√âvaluations Pr√©c√©dentes">√âvaluations Pr√©c√©dentes</button>
            </div>

            <!-- New Evaluation Tab -->
            <div id="new-evaluation-content" class="tab-content active">
                <h3 data-lang-en="Select a teacher to evaluate:" data-lang-fr="S√©lectionnez un enseignant √† √©valuer :">S√©lectionnez un enseignant √† √©valuer :</h3>
                <select id="teacher-select"></select>
                <div id="evaluation-form-container"></div>
            </div>

            <!-- Previous Evaluations Tab -->
            <div id="previous-evaluations-content" class="tab-content">
                <h3 data-lang-en="Select a teacher to view evaluations:" data-lang-fr="S√©lectionnez un enseignant pour voir les √©valuations :">S√©lectionnez un enseignant pour voir les √©valuations :</h3>
                <select id="teacher-select-view"></select>
                <div id="previous-evaluations-container"></div>
            </div>

            <button id="logout-btn" data-lang-en="Logout" data-lang-fr="D√©connexion">D√©connexion</button>
        </div>

        <!-- Teacher Dashboard -->
        <div id="teacher-dashboard" class="page">
            <h1 data-lang-en="Teacher Dashboard" data-lang-fr="Tableau de Bord Enseignant">Teacher Dashboard</h1>
            <h2 id="teacher-welcome"></h2>
            <div id="evaluation-reports"></div>
            <button id="logout-btn-teacher" data-lang-en="Logout" data-lang-fr="D√©connexion">Logout</button>
        </div>

    </div>

    <script>
        // --- Client-Side Logic ---
        document.addEventListener('DOMContentLoaded', () => {
            const state = {
                currentUser: null,
                currentLang: 'en'
            };

            const pages = {
                login: document.getElementById('login-page'),
                coordinator: document.getElementById('coordinator-dashboard'),
                teacher: document.getElementById('teacher-dashboard')
            };

            // --- Language Switcher ---
            const langElements = document.querySelectorAll('[data-lang-en], [data-lang-fr]');
            const placeholderElements = document.querySelectorAll('[placeholder-en], [placeholder-fr]');

            function setLanguage(lang) {
                state.currentLang = lang;
                langElements.forEach(el => {
                    el.textContent = el.dataset[`lang-${lang}`];
                    if(el.tagName === 'TITLE') document.title = el.dataset[`lang-${lang}`];
                });
                placeholderElements.forEach(el => {
                    el.placeholder = el.getAttribute(`placeholder-${lang}`);
                });
            }

            document.getElementById('lang-en').addEventListener('click', () => setLanguage('en'));
            document.getElementById('lang-fr').addEventListener('click', () => setLanguage('fr'));

            // --- Password Toggle Functionality ---
            document.getElementById('toggle-password').addEventListener('click', function() {
                const passwordInput = document.getElementById('password');
                const passwordIcon = document.getElementById('password-icon');
                
                if (passwordInput.type === 'password') {
                    passwordInput.type = 'text';
                    passwordIcon.textContent = 'üôà';
                } else {
                    passwordInput.type = 'password';
                    passwordIcon.textContent = 'üëÅÔ∏è';
                }
            });

            // --- Remember Me Functionality ---
            // Charger les donn√©es sauvegard√©es au d√©marrage
            function loadSavedCredentials() {
                const savedCredentials = localStorage.getItem('teacherEvaluationCredentials');
                if (savedCredentials) {
                    const { username, password, rememberMe } = JSON.parse(savedCredentials);
                    if (rememberMe) {
                        document.getElementById('username').value = username;
                        document.getElementById('password').value = password;
                        document.getElementById('remember-me').checked = true;
                    }
                }
            }

            // Sauvegarder les donn√©es si "Rester connect√©" est coch√©
            function saveCredentials(username, password, rememberMe) {
                if (rememberMe) {
                    const credentials = { username, password, rememberMe: true };
                    localStorage.setItem('teacherEvaluationCredentials', JSON.stringify(credentials));
                } else {
                    localStorage.removeItem('teacherEvaluationCredentials');
                }
            }

            // Charger les donn√©es sauvegard√©es au d√©marrage
            loadSavedCredentials();

            // --- Navigation ---
            function showPage(pageName) {
                Object.values(pages).forEach(page => page.classList.remove('active'));
                pages[pageName].classList.add('active');
            }

            // --- Base de donn√©es utilisateurs c√¥t√© client (solution temporaire fonctionnelle) ---
            const USERS_DATABASE = [
                // Coordinateurs
                { username: 'Mohamed', password: 'Mohamed@86', role: 'coordinator', assignedTeachers: ['Morched', 'Kamel', 'Abas', 'Zine', 'Youssef', 'Oumarou', 'Tonga', 'Sylvano', 'Sami', 'Mohamed Ali'] },
                { username: 'Zohra', password: 'Zohra@40', role: 'coordinator', assignedTeachers: ['Aichetou', 'Inas', 'Anwar', 'Souha', 'Amal', 'Shanouja', 'Jana', 'Hiba'] },
                { username: 'Rasha', password: 'Rasha@26', role: 'coordinator', assignedTeachers: ['Amal', 'Rouba', 'Rayan', 'Imane', 'Nesrine', 'Fatima', 'Samar', 'Romana', 'Nour'] },
                // Enseignants
                ...['Morched', 'Kamel', 'Abas', 'Zine', 'Youssef', 'Oumarou', 'Tonga', 'Sylvano', 'Sami', 'Mohamed Ali', 'Aichetou', 'Inas', 'Anwar', 'Souha', 'Amal', 'Shanouja', 'Jana', 'Hiba', 'Rouba', 'Rayan', 'Imane', 'Nesrine', 'Fatima', 'Samar', 'Romana', 'Nour'].map(name => ({ username: name, password: name, role: 'teacher' }))
            ];

            // Base de donn√©es √©valuations c√¥t√© client
            let EVALUATIONS_DATABASE = [];

            // --- Login Logic (c√¥t√© client - fonctionne imm√©diatement) ---
            document.getElementById('login-form').addEventListener('submit', (e) => {
                e.preventDefault();
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;
                const rememberMe = document.getElementById('remember-me').checked;
                
                console.log(`Tentative de connexion: ${username} / ${password}`);
                
                // Recherche dans la base de donn√©es locale
                const user = USERS_DATABASE.find(u => u.username === username && u.password === password);
                
                if (user) {
                    console.log(`Connexion r√©ussie pour: ${username} (${user.role})`);
                    
                    // Sauvegarder les identifiants si demand√©
                    saveCredentials(username, password, rememberMe);
                    
                    state.currentUser = user;
                    if (user.role === 'coordinator') {
                        renderCoordinatorDashboard();
                        showPage('coordinator');
                    } else {
                        renderTeacherDashboard();
                        showPage('teacher');
                    }
                    
                    // Effacer les messages d'erreur
                    document.getElementById('login-error').textContent = '';
                } else {
                    console.log(`√âchec de connexion pour: ${username}`);
                    document.getElementById('login-error').textContent = state.currentLang === 'fr' ? 'Identifiants invalides' : 'Invalid credentials';
                }
            });
            
            // --- Logout ---
            function logout() {
                state.currentUser = null;
                document.getElementById('login-form').reset();
                document.getElementById('login-error').textContent = '';
                
                // Ne pas effacer les identifiants si "Rester connect√©" est coch√©
                const rememberMe = document.getElementById('remember-me').checked;
                if (!rememberMe) {
                    localStorage.removeItem('teacherEvaluationCredentials');
                } else {
                    // Recharger les identifiants sauvegard√©s
                    loadSavedCredentials();
                }
                
                showPage('login');
            }
            document.getElementById('logout-btn').addEventListener('click', logout);
            document.getElementById('logout-btn-teacher').addEventListener('click', logout);


            // --- Coordinator Logic ---
            function renderCoordinatorDashboard() {
                document.getElementById('coordinator-welcome').textContent = `${state.currentLang === 'fr' ? 'Bienvenue' : 'Welcome'}, ${state.currentUser.username}`;
                
                // Populate both teacher selects
                populateTeacherSelects();
                
                // Setup tab switching
                setupCoordinatorTabs();
            }

            function populateTeacherSelects() {
                const teacherSelect = document.getElementById('teacher-select');
                const teacherSelectView = document.getElementById('teacher-select-view');
                
                [teacherSelect, teacherSelectView].forEach(select => {
                    if(select) {
                        select.innerHTML = `<option value="">${state.currentLang === 'fr' ? 'Choisir...' : 'Choose...'}</option>`;
                        state.currentUser.assignedTeachers.forEach(teacher => {
                            const option = document.createElement('option');
                            option.value = teacher;
                            option.textContent = teacher;
                            select.appendChild(option);
                        });
                    }
                });
            }

            function setupCoordinatorTabs() {
                const newEvalTab = document.getElementById('new-evaluation-tab');
                const viewEvalTab = document.getElementById('view-evaluations-tab');
                const newEvalContent = document.getElementById('new-evaluation-content');
                const viewEvalContent = document.getElementById('previous-evaluations-content');

                function switchTab(activeTab, activeContent) {
                    // Remove active classes
                    [newEvalTab, viewEvalTab].forEach(tab => tab && tab.classList.remove('active'));
                    [newEvalContent, viewEvalContent].forEach(content => content && content.classList.remove('active'));
                    
                    // Add active classes
                    if(activeTab) activeTab.classList.add('active');
                    if(activeContent) activeContent.classList.add('active');
                }

                if(newEvalTab) {
                    newEvalTab.addEventListener('click', () => {
                        switchTab(newEvalTab, newEvalContent);
                    });
                }

                if(viewEvalTab) {
                    viewEvalTab.addEventListener('click', () => {
                        switchTab(viewEvalTab, viewEvalContent);
                    });
                }

                // Handle previous evaluations view
                const teacherSelectView = document.getElementById('teacher-select-view');
                if(teacherSelectView) {
                    teacherSelectView.addEventListener('change', (e) => {
                        const teacherName = e.target.value;
                        if (teacherName) {
                            renderPreviousEvaluations(teacherName);
                        } else {
                            const container = document.getElementById('previous-evaluations-container');
                            if(container) container.innerHTML = '';
                        }
                    });
                }
            }

            function renderPreviousEvaluations(teacherName) {
                const container = document.getElementById('previous-evaluations-container');
                if(!container) return;
                
                // Filter evaluations for selected teacher by current coordinator
                const evaluations = EVALUATIONS_DATABASE
                    .filter(eval => eval.teacherName === teacherName && eval.coordinatorName === state.currentUser.username)
                    .sort((a, b) => new Date(b.date) - new Date(a.date));

                if (evaluations.length === 0) {
                    container.innerHTML = `<div class="card">
                        <p>${state.currentLang === 'fr' ? 'Aucune √©valuation trouv√©e pour cet enseignant.' : 'No evaluations found for this teacher.'}</p>
                    </div>`;
                    return;
                }

                let html = `<div class="card">
                    <h3>${state.currentLang === 'fr' ? '√âvaluations pr√©c√©dentes pour' : 'Previous evaluations for'} ${teacherName}</h3>
                    <div class="evaluations-list">`;

                evaluations.forEach((evaluation, index) => {
                    const evalDate = new Date(evaluation.date);
                    const isLatest = index === 0;
                    
                    html += `
                        <div class="evaluation-item ${isLatest ? 'latest' : ''}" style="border: 1px solid #ddd; margin: 10px 0; padding: 15px; border-radius: 8px;">
                            <div class="eval-summary" style="display: flex; justify-content: space-between; align-items: center;">
                                <div class="eval-info">
                                    <h4>${state.currentLang === 'fr' ? '√âvaluation du' : 'Evaluation from'} ${evalDate.toLocaleDateString(state.currentLang === 'fr' ? 'fr-FR' : 'en-US')}</h4>
                                    <div class="eval-meta">
                                        ${evaluation.visitDate ? `<span><strong>${state.currentLang === 'fr' ? 'Date de visite :' : 'Visit Date:'}</strong> ${evaluation.visitDate}</span><br>` : ''}
                                        ${evaluation.lessonSubject ? `<span><strong>${state.currentLang === 'fr' ? 'Mati√®re :' : 'Subject:'}</strong> ${evaluation.lessonSubject}</span><br>` : ''}
                                        ${evaluation.className ? `<span><strong>${state.currentLang === 'fr' ? 'Classe :' : 'Class:'}</strong> ${evaluation.className}</span><br>` : ''}
                                        ${evaluation.semester ? `<span><strong>${state.currentLang === 'fr' ? 'Semestre :' : 'Semester:'}</strong> ${evaluation.semester === '1' ? (state.currentLang === 'fr' ? '1er Semestre' : '1st Semester') : (state.currentLang === 'fr' ? '2√®me Semestre' : '2nd Semester')}</span>` : ''}
                                    </div>
                                </div>
                                <div class="eval-score-section">
                                    <div class="eval-score" style="font-size: 1.5em; font-weight: bold; color: #4a90e2;">${evaluation.grandTotal}/100</div>
                                    <div class="eval-level" style="padding: 4px 12px; border-radius: 15px; font-size: 0.8em; font-weight: bold; background: #28a745; color: white;">
                                        ${evaluation.performanceLevel || getPerformanceLevel(evaluation.grandTotal)}
                                    </div>
                                </div>
                            </div>
                            
                            <div class="eval-actions" style="margin-top: 10px; display: flex; gap: 10px;">
                                <button class="action-btn view-btn" onclick="toggleEvaluationDetails('${evaluation.id}')" style="padding: 8px 15px; background: #4a90e2; color: white; border: none; border-radius: 5px; cursor: pointer;">
                                    <span id="toggle-text-${evaluation.id}">${state.currentLang === 'fr' ? 'Voir d√©tails' : 'View Details'}</span>
                                </button>
                                <button class="action-btn word-btn" onclick="generateWordReport('${evaluation.id}')" style="padding: 8px 15px; background: #28a745; color: white; border: none; border-radius: 5px; cursor: pointer;">
                                    ${state.currentLang === 'fr' ? 'G√©n√©rer Word' : 'Generate Word'}
                                </button>
                            </div>
                            
                            <div id="details-${evaluation.id}" class="eval-details-full" style="display: none; margin-top: 15px; padding: 15px; background: #f8f9fa; border-radius: 5px;">
                                <div class="eval-comments">
                                    ${evaluation.comments && evaluation.comments.strengths ? `
                                    <div class="comment-section" style="margin-bottom: 15px;">
                                        <h5>${state.currentLang === 'fr' ? 'Points forts' : 'Strengths'}</h5>
                                        <p>${evaluation.comments.strengths}</p>
                                    </div>` : ''}
                                    
                                    ${evaluation.comments && evaluation.comments.toImprove ? `
                                    <div class="comment-section" style="margin-bottom: 15px;">
                                        <h5>${state.currentLang === 'fr' ? '√Ä am√©liorer' : 'To Improve'}</h5>
                                        <p>${evaluation.comments.toImprove}</p>
                                    </div>` : ''}
                                    
                                    ${evaluation.comments && evaluation.comments.recommendations ? `
                                    <div class="comment-section" style="margin-bottom: 15px;">
                                        <h5>${state.currentLang === 'fr' ? 'Recommandations' : 'Recommendations'}</h5>
                                        <p>${evaluation.comments.recommendations}</p>
                                    </div>` : ''}
                                </div>
                            </div>
                        </div>`;
                });

                html += `</div></div>`;
                container.innerHTML = html;
            }

            document.getElementById('teacher-select').addEventListener('change', (e) => {
                const teacherName = e.target.value;
                if (teacherName) {
                    renderEvaluationForm(teacherName);
                } else {
                    document.getElementById('evaluation-form-container').innerHTML = '';
                }
            });

            // --- Evaluation Form ---
            function renderEvaluationForm(teacherName) {
                const criteria = {
                    professionalOutlook: {
                        title_en: "PROFESSIONAL OUTLOOK",
                        title_fr: "PERSPECTIVE PROFESSIONNELLE",
                        items: [
                            { text_en: "Speaks with an effective voice and tone.", text_fr: "Parle avec une voix et un ton efficaces." },
                            { text_en: "Uses standard English in both oral and written expression.", text_fr: "Utilise un anglais standard √† l'oral et √† l'√©crit." },
                            { text_en: "Uses appropriate eye contact, body language, movement, and posture.", text_fr: "Utilise un contact visuel, un langage corporel, des mouvements et une posture appropri√©s." },
                        ]
                    },
                    contentKnowledge: {
                         title_en: "CONTENT KNOWLEDGE",
                         title_fr: "CONNAISSANCE DU CONTENU",
                         items: [
                            { text_en: "Integrates literacy AND mathematics into content area instruction when necessary.", text_fr: "Int√®gre la litt√©ratie ET les math√©matiques dans l'enseignement disciplinaire si n√©cessaire." },
                            { text_en: "Demonstrates appropriate level of knowledge and skills in content area(s).", text_fr: "D√©montre un niveau appropri√© de connaissances et de comp√©tences dans le(s) domaine(s) de contenu." },
                         ]
                    },
                    instructionAndAssessments: {
                        title_en: "INSTRUCTION AND ASSESSMENTS",
                        title_fr: "ENSEIGNEMENT ET √âVALUATIONS",
                        items: [
                            { text_en: "Prepares detailed lesson plans with significant objectives that reflect key concepts.", text_fr: "Pr√©pare des plans de le√ßon d√©taill√©s avec des objectifs significatifs qui refl√®tent les concepts cl√©s."},
                            { text_en: "Plans instructional strategies and activities that require higher order thinking skills.", text_fr: "Planifie des strat√©gies et des activit√©s p√©dagogiques qui n√©cessitent des comp√©tences de pens√©e d'ordre sup√©rieur."},
                            { text_en: "Uses questioning strategies to engage students and stimulate higher order thinking.", text_fr: "Utilise des strat√©gies de questionnement pour engager les √©tudiants et stimuler la pens√©e d'ordre sup√©rieur."},
                        ]
                    }
                };

                let formHTML = `<form id="eval-form" class="card"><h3>${state.currentLang === 'fr' ? '√âvaluation pour' : 'Evaluation for'} ${teacherName}</h3>`;
                let criteriaIndex = 0;
                
                for(const category in criteria){
                    formHTML += `<fieldset><legend>${criteria[category][`title_${state.currentLang}`]}</legend>`;
                    criteria[category].items.forEach((item, index) => {
                        formHTML += `<div class="criteria-row">
                            <p>${item[`text_${state.currentLang}`]}</p>
                            <div class="rating">
                                ${[1,2,3,4,5].map(num => `
                                <input type="radio" id="crit${criteriaIndex}-${num}" name="crit${criteriaIndex}" value="${num}" required>
                                <label for="crit${criteriaIndex}-${num}">${num}</label>
                                `).join('')}
                            </div>
                        </div>`;
                        criteriaIndex++;
                    });
                    formHTML += `</fieldset>`;
                }
                
                formHTML += `
                    <div class="comments-section">
                        <div>
                            <label for="comments-improve" data-lang-en="Comments (To Improve)" data-lang-fr="Commentaires (√Ä am√©liorer)">Comments (To Improve)</label>
                            <textarea id="comments-improve" required></textarea>
                        </div>
                        <div>
                            <label for="comments-eliminate" data-lang-en="Comments (To Eliminate)" data-lang-fr="Commentaires (√Ä √©liminer)">Comments (To Eliminate)</label>
                            <textarea id="comments-eliminate" required></textarea>
                        </div>
                    </div>
                    <div class="grand-total">
                        <span data-lang-en="Grand Total:" data-lang-fr="Total G√©n√©ral :">Grand Total:</span>
                        <span id="grand-total-display">0</span>
                    </div>
                    <button type="submit" data-lang-en="Submit Evaluation" data-lang-fr="Soumettre l'√©valuation">Submit Evaluation</button>
                </form>`;

                const container = document.getElementById('evaluation-form-container');
                container.innerHTML = formHTML;

                // Automatic Total Calculation
                container.querySelector('#eval-form').addEventListener('change', () => {
                    const ratings = container.querySelectorAll('input[type="radio"]:checked');
                    let total = 0;
                    ratings.forEach(r => total += parseInt(r.value, 10));
                    document.getElementById('grand-total-display').textContent = total;
                });
                
                // Form Submission
                container.querySelector('#eval-form').addEventListener('submit', async (e) => {
                    e.preventDefault();
                    const formData = new FormData(e.target);
                    const criteriaData = {};
                    let grandTotal = 0;
                    for(let [key, value] of formData.entries()){
                        criteriaData[key] = parseInt(value, 10);
                        grandTotal += parseInt(value, 10);
                    }
                    
                    const payload = {
                        teacherName,
                        coordinatorName: state.currentUser.username,
                        criteria: criteriaData,
                        comments: {
                            toImprove: document.getElementById('comments-improve').value,
                            toEliminate: document.getElementById('comments-eliminate').value
                        },
                        grandTotal
                    };

                    // Sauvegarder l'√©valuation dans la base locale
                    const evaluation = {
                        id: Date.now().toString(),
                        ...payload,
                        date: new Date()
                    };
                    
                    EVALUATIONS_DATABASE.push(evaluation);
                    console.log('√âvaluation sauvegard√©e:', evaluation);
                    
                    alert(state.currentLang === 'fr' ? '√âvaluation soumise avec succ√®s !' : 'Evaluation submitted successfully!');
                    container.innerHTML = '';
                    
                    // R√©initialiser la s√©lection d'enseignant
                    document.getElementById('teacher-select').value = '';
                });
            }

            // --- Teacher Logic ---
            function renderTeacherDashboard() {
                document.getElementById('teacher-welcome').textContent = `${state.currentLang === 'fr' ? 'Bienvenue' : 'Welcome'}, ${state.currentUser.username}`;
                const reportsContainer = document.getElementById('evaluation-reports');
                
                // Filtrer les √©valuations pour cet enseignant dans la base locale
                const evaluations = EVALUATIONS_DATABASE.filter(eval => eval.teacherName === state.currentUser.username);
                console.log(`Trouv√© ${evaluations.length} √©valuations pour ${state.currentUser.username}`);
                
                if (evaluations.length === 0) {
                    reportsContainer.innerHTML = `<p>${state.currentLang === 'fr' ? 'Aucun rapport d\'√©valuation trouv√©.' : 'No evaluation reports found.'}</p>`;
                    return;
                }
                    
                    let reportsHTML = '';
                    evaluations.forEach(eval => {
                        reportsHTML += `
                            <div class="card report-card">
                                <h3>${state.currentLang === 'fr' ? 'Rapport du' : 'Report from'} ${new Date(eval.date).toLocaleDateString()}</h3>
                                <p><strong>${state.currentLang === 'fr' ? '√âvaluateur :' : 'Evaluator:'}</strong> ${eval.coordinatorName}</p>
                                <p><strong>${state.currentLang === 'fr' ? 'Total G√©n√©ral :' : 'Grand Total:'}</strong> ${eval.grandTotal}</p>
                                <div class="comments-section">
                                    <div>
                                        <h4>${state.currentLang === 'fr' ? 'Recommandations (√Ä am√©liorer)' : 'Recommendations (To Improve)'}</h4>
                                        <p>${eval.comments.toImprove}</p>
                                    </div>
                                    <div>
                                        <h4>${state.currentLang === 'fr' ? 'Recommandations (√Ä √©liminer)' : 'Recommendations (To Eliminate)'}</h4>
                                        <p>${eval.comments.toEliminate}</p>
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                reportsContainer.innerHTML = reportsHTML;
            }
            
            // Initial load
            // --- Utility Functions ---
            function getPerformanceLevel(score) {
                const isFrench = state.currentLang === 'fr';
                if (score >= 85) return isFrench ? 'Excellent' : 'Excellent';
                if (score >= 70) return isFrench ? 'Bon' : 'Good';
                if (score >= 60) return isFrench ? 'Satisfaisant' : 'Satisfactory';
                if (score >= 50) return isFrench ? '√Ä am√©liorer' : 'Needs Improvement';
                return isFrench ? 'Insuffisant' : 'Poor';
            }

            function generateWordReport(evaluationId) {
                const evaluation = EVALUATIONS_DATABASE.find(eval => eval.id === evaluationId);
                if (!evaluation) {
                    alert(state.currentLang === 'fr' ? '√âvaluation non trouv√©e' : 'Evaluation not found');
                    return;
                }
                
                const fileName = `Evaluation_${evaluation.teacherName}_${new Date(evaluation.date).toISOString().split('T')[0]}.docx`;
                alert(state.currentLang === 'fr' ? `G√©n√©ration du document Word: ${fileName}\n\nScore: ${evaluation.grandTotal}/100\nNiveau: ${evaluation.performanceLevel || getPerformanceLevel(evaluation.grandTotal)}` : `Generating Word document: ${fileName}\n\nScore: ${evaluation.grandTotal}/100\nLevel: ${evaluation.performanceLevel || getPerformanceLevel(evaluation.grandTotal)}`);
            }

            function toggleEvaluationDetails(evaluationId) {
                const detailsElement = document.getElementById(`details-${evaluationId}`);
                const toggleText = document.getElementById(`toggle-text-${evaluationId}`);
                
                if (detailsElement && toggleText) {
                    if (detailsElement.style.display === 'none') {
                        detailsElement.style.display = 'block';
                        toggleText.textContent = state.currentLang === 'fr' ? 'Masquer d√©tails' : 'Hide Details';
                    } else {
                        detailsElement.style.display = 'none';
                        toggleText.textContent = state.currentLang === 'fr' ? 'Voir d√©tails' : 'View Details';
                    }
                }
            }

            // Make functions global for onclick handlers
            window.toggleEvaluationDetails = toggleEvaluationDetails;
            window.generateWordReport = generateWordReport;

            setLanguage('en');
        });
    </script>
</body>
</html>